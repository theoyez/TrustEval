<!doctype html><html lang="en"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>TrustEval-Core</title>
<link rel="stylesheet" href="config/theme.css">
<style>
body{background:var(--bg);color:var(--ink);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:0}
a{color:#cfd3d8;text-decoration:none} a:hover{text-decoration:underline}
header{background:var(--panel);border-bottom:1px solid var(--muted);padding:14px 16px;display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap}
.btn{display:inline-block;padding:8px 12px;border:1px solid var(--muted);border-radius:10px;background:#141617;color:var(--ink)}
.container{max-width:1100px;margin:0 auto;padding:0 16px}
.small{color:var(--ink-dim);font-size:12px}
.table{width:100%;border-collapse:collapse;margin:12px 0;background:var(--card);border:1px solid var(--muted);border-radius:12px;overflow:hidden}
.table th,.table td{padding:12px;border-bottom:1px solid var(--muted);vertical-align:top}
.table thead th{position:sticky;top:0;background:#141617;z-index:2}
.row:hover{background:#16181a}
.badge{display:inline-flex;gap:6px;padding:2px 8px;border-radius:999px;border:1px solid var(--muted);background:#131416;font-size:12px}
.badge.ok{border-color:var(--ok);color:#d7ffe8} .badge.warn{border-color:var(--warn);color:#fff3bf} .badge.err{border-color:var(--err);color:#ffd7d7}
.chev{cursor:pointer;display:inline-flex;align-items:center;gap:6px}
.drawer{display:none;padding:10px;border:1px solid var(--muted);border-radius:10px;background:#121416;margin:8px 0}
.chips{display:flex;gap:6px;flex-wrap:wrap;margin-top:4px}
.chip{font-size:11px;border:1px solid var(--muted);border-radius:999px;padding:2px 8px;background:#131416;cursor:pointer}
.arrow{opacity:.7;margin-left:6px}
.input{width:100%;padding:10px;border:1px solid var(--muted);border-radius:10px;margin:10px 0 16px;background:#121416;color:#fff}
.info{border:1px solid var(--muted);border-radius:12px;background:#121416;padding:12px;margin:14px 0}
.footer{color:var(--ink-dim);font-size:12px;margin:20px 0}
</style>
<script>
let runs=[], sortKey=null, sortAsc=true, filterTerm="";
const pct=x=> (x*100).toFixed(1)+'%';
function chip(text){ return '<span class="chip" data-chip="'+text+'">'+text+'</span>'; }
function setSortIndicator(map, key){document.querySelectorAll('.sortable').forEach(th=>{ th.setAttribute('aria-sort','none'); th.querySelector('.arrow').textContent='↕'; });
  const th=document.getElementById(map[key]); if(!th) return; th.setAttribute('aria-sort',sortAsc?'ascending':'descending'); th.querySelector('.arrow').textContent=sortAsc?'▲':'▼';}
function renderRows(){
  const tbody=document.querySelector('tbody');
  const view=runs.filter(r=>{ if(!filterTerm) return true; const hay=(r.run_id+' '+(r.model||'')+' '+Object.values(r.meta||{}).join(' ')).toLowerCase(); return hay.includes(filterTerm); });
  tbody.innerHTML=view.map(r=>ROW_HTML(r)).join('');
  document.querySelectorAll('.chev').forEach(el=>{ el.addEventListener('click',()=>{ const id=el.getAttribute('data-run'); const dr=document.getElementById('drawer_'+id);
    const open=dr.style.display!=='block'; dr.style.display=open?'block':'none'; el.setAttribute('aria-expanded',open?'true':'false'); el.firstChild.textContent=open?'▾':'▸'; }); });
}
function applySort(key, map){
  if (sortKey===key) sortAsc=!sortAsc; else { sortKey=key; sortAsc=true; }
  runs.sort((a,b)=>{ const av=a[key], bv=b[key]; if(typeof av==='number'&&typeof bv==='number') return sortAsc?av-bv:bv-av; return sortAsc?String(av||'').localeCompare(String(bv||'')):String(bv||'').localeCompare(String(av||'')); });
  setSortIndicator(map,key); renderRows();
}
async function load(){
  const site = await fetch('config/site.json').then(r=>r.json());
  const board = await fetch('leaderboard.json').then(r=>r.json());
  runs = (board.runs||[]).slice();
  document.getElementById('lastUpdated').textContent=board.updated_at||'—';
  const map={"run_id":"th-run_id","model":"th-model"};
  const head=document.getElementById('thead');
  head.innerHTML = '<th id="th-run_id" class="sortable">Run <span class="arrow">↕</span></th><th id="th-model" class="sortable">Model <span class="arrow">↕</span></th>' +
    site.show_columns.filter(k=>k!=='run_id'&&k!=='model').map(k=>'<th id="th-'+k+'" class="sortable right">'+(site.labels[k]||k)+' <span class="arrow">↕</span></th>').join('') +
    '<th>Audit</th><th>Report</th>';
  site.show_columns.forEach(k=>{ if(!map[k]) map[k]='th-'+k; });
  window.ROW_HTML = function(r){
    const scoreCells = site.show_columns.filter(k=>!['run_id','model'].includes(k)).map(k=>'<td class="right">'+pct(r[k]||0)+'</td>').join('');
    const status=(r.audit && r.audit.status)||'ok'; const icon=(status==='ok'?'✓':(status==='warn'?'!':'✖')); const badgeCls = status==='ok'?'badge ok':(status==='warn'?'badge warn':'badge err');
    const metaChips = r.meta ? ['dataset','prompt_cfg','retriever','date','prov'].filter(k=>r.meta[k]).map(k=>chip(k+':'+r.meta[k])).join(' ') : '';
    return '<tr class="row">'
      + '<td>'+r.run_id+'</td>'
      + '<td>'+(r.model||'—')+'<div class="chips">'+metaChips+'</div></td>'
      + scoreCells
      + '<td><span class="chev" data-run="'+r.run_id+'" aria-expanded="false">▸ <span class="'+badgeCls+'">'+icon+' '+status+'</span></span></td>'
      + '<td><a href="'+r.report+'">Report</a></td>'
      + '</tr>'
      + '<tr><td colspan="'+(site.show_columns.length+2)+'"><div class="drawer" id="drawer_'+r.run_id+'">'
      + '<div style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px">'
      + '<div class="card"><b>Retrieval candidates</b><ul class="small">'+ ((r.audit&&r.audit.trail)||[]).map(t=>'<li><code>'+t.doc+'</code> · chunk <b>'+t.chunk+'</b> · score '+t.score+'</li>').join('') +'</ul></div>'
      + '<div class="card"><b>Citations used</b><ul class="small">'+ ((r.audit&&r.audit.citations)||[]).map(c=>'<li><code>'+c+'</code></li>').join('') +'</ul></div>'
      + '<div class="card"><b>Proof path</b><p class="small">'+ ((r.audit&&r.audit.proof_path)||'—') +'</p></div>'
      + '</div></div></td></tr>';
  };
  renderRows();
  Array.from(head.children).forEach(th=>{
    if(!th.classList.contains('sortable')) return;
    const key=Object.entries(map).find(([k,v])=>v===th.id)?.[0]; if(!key) return;
    th.addEventListener('click',()=>applySort(key,map)); th.tabIndex=0; th.addEventListener('keydown',e=>{ if(e.key==='Enter'||e.key===' '){ e.preventDefault(); applySort(key,map);} });
  });
  const f=document.getElementById('filter'); f.addEventListener('input', e=>{ filterTerm=(e.target.value||'').toLowerCase(); renderRows(); });
}
window.addEventListener('DOMContentLoaded', load);
</script>
</head><body>
<header>
  <div><a class="btn" href="https://theoyez.org" target="_blank">theoyez.org</a></div>
  <nav>
    <a id="sampleReport" class="btn" href="javascript:void(0)" onclick="location.href=(runs[0]||{}).report||'#'">View sample report</a>
    <a class="btn" href="web/compare.html">Compare</a>
    <a class="btn" href="web/how-it-works.html">How it works</a>
    <a class="btn" href="README.md" target="_blank">README</a>
  </nav>
</header>
<div class="container">
  <div class="info">
    <h2 style="margin:6px 0">TrustEval-Core</h2>
    <p class="small">Weights (display blend): {"accuracy": 0.6, "grounding": 0.3, "safety": 0.1}</p>
    <p class="small">Audit = retrieval⇄citation alignment. <span class="badge ok">✓ ok</span> pass · <span class="badge warn">! warn</span> partial · <span class="badge err">✖ error</span> failed.</p>
  </div>
  <input id="filter" class="input" placeholder="Filter by run id, model, or chip (dataset:, retriever:, ... )"/>
  <table class="table">
    <thead><tr id="thead"></tr></thead>
    <tbody></tbody>
  </table>
  <p class="small">Config files: <code>config/site.json</code>, <code>config/weights.json</code>, <code>config/theme.css</code></p>
  <p class="small">Schema: <code>config/metrics.schema.json</code></p>
  <p class="small">Updated: <span id="lastUpdated">—</span></p>
</div>
</body></html>